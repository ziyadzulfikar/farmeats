{% extends "base.html" %}
{% block content %}
<div class="container mt-5">
    <br>
    <div class="row">
        <div class="col-md-6 mt-3 mb-4">
            <form class="p-5" method="POST" action="addProduct" enctype="multipart/form-data"  style="border-radius:20px; border:none; box-shadow: 0 4px 89px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);">
                {% csrf_token %}
                <div class="mb-3">
                    <h3 for="exampleInputEmail1" class="form-label">Add Product</h3>
                </div>
                <div class="mb-3">
                    <label for="exampleInputEmail1" class="form-label">Product Name</label>
                    <input type="text" name="pdtname" class="form-control">
                </div>
                <div class="mb-3">
                    <label for="exampleInputPassword1" class="form-label">Category</label>
                    <select class="form-select" name="category" aria-label="Default select example">
                        <option selected>Select a Category</option>
                        <option value="Burger">Burger</option>
                        <option value="Pizza">Pizza</option>
                        <option value="Shawarma">Shawarma</option>
                        <option value="FriedChicken">Fried Chicken</option>
                        <option value="Juices">Juices</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label for="exampleInputEmail1" class="form-label">Price</label>
                    <input type="text" name="price" class="form-control">
                </div>
                <div class="mb-3">
                    <label for="exampleInputEmail1" class="form-label">Description</label>
                    <input type="text" name="desc" class="form-control">
                </div>
                    
                <input type="file" name="image" id="">
                <h4></h4>
                <div>
                    <button type="submit" name="upload" class="btn btn-success mt-3">Submit</button>
                </div>
            </form>
        </div>

        <!-- Expenses -->
        <div class="col-md-6 mt-3">
            <form class="p-5" method="POST" action="expenses"  style="border-radius:20px; border:none; box-shadow: 0 4px 89px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);">
              {% csrf_token %}
              <div class="mb-3">
                <h3 for="exampleInputEmail1" class="form-label">Expenses</h3>
              </div>
              <div class="mb-3">
                <label for="exampleInputEmail1" class="form-label">Cost for the food items</label>
                <input type="text" name="FoodItems" class="form-control" required>
              </div>
              <div class="mb-3">
                <label for="exampleInputPassword1" class="form-label">Rent</label>
                <input type="text" name="Rent" class="form-control">
              </div>
              <div class="mb-3">
                  <label for="exampleInputEmail1" class="form-label">Electricity</label>
                  <input type="text" name="Electricity" class="form-control">
                </div>
              <div class="mb-3">
                  <label for="exampleInputEmail1" class="form-label">Total Salary</label>
                  <input type="text" name="TotalSalary" class="form-control">
                </div>
              <div class="mb-3">
                  <label for="exampleInputEmail1" class="form-label">Other Expenses</label>
                  <input type="text" name="OtherExpense" class="form-control">
                </div>
                <div>
                  <input type="hidden" name="CurrentDate" value="">
                  <button type="submit" name="expense" class="btn btn-success mt-3">Submit</button>
              </div>
            </form>
        </div>

        <!-- Income -->
        <div class="col-md-6 mt-3">
            <form class="p-5" method="POST" action="addIncome"  style="border-radius:20px; border:none; box-shadow: 0 4px 89px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);">
              {% csrf_token %}
              <div class="mb-3">
                <h3 for="exampleInputEmail1" class="form-label">Income</h3>
              </div>
              <div class="mb-3">
                <label for="exampleInputPassword1" class="form-label">Product Name</label>
                <select class="form-select" name="ProductName" aria-label="Default select example">
                  <option selected>Select a Product</option>
                  {% for products in allProducts %}
                          <option value="{{products.productname}}">{{products.productname}}</option>
                  {% endfor %}
                </select>
              </div>
              <div class="mb-3">
                <label for="exampleInputEmail1" class="form-label">Quantity</label>
                <input type="text" name="Quantity" class="form-control">
              </div>
              <div class="mb-3">
                <label for="exampleInputPassword1" class="form-label">Price</label>
                <input type="text" name="Price" class="form-control">
              </div>
              <div class="mb-3">
                <label for="exampleInputPassword1" class="form-label">Category</label>
                <select class="form-select" name="category" aria-label="Default select example">
                  <option selected>Select a Category</option>
                  <option value="Burger">Burger</option>
                  <option value="Pizza">Pizza</option>
                  <option value="Shawarma">Shawarma</option>
                  <option value="FriedChicken">Fried Chicken</option>
                  <option value="Juices">Juices</option>
                </select>
              </div>
              <div class="mb-3">
                <label for="exampleInputPassword1" class="form-label">Date</label>
                <input type="date" name="CurrentDate" class="form-control">
              </div>
              <div>  
                  <input type="hidden" name="user" value="{{session.id}}">
                  <input type="hidden" name="delivery" value="Delivered">
                  <button type="submit" name="income" class="btn btn-success mt-3">Submit</button>
              </div>
            </form>
        </div>
    </div>
</div>


<span id="products"></span>
<div class="container mt-5 mb-5">
    <h3>Products</h3>
    <table id="table_products" class="display table">
        <thead class="table-success">
            <tr>
                <th>Name</th>
                <th>Category</th>
                <th>Price</th>
                <th>Description</th>
                <th>offer</th>
                <th>active</th>
                <th>Delete</th>
            </tr>
        </thead>
        <tbody>
            {% for products in allProducts %}
            <tr>
                <td>{{products.productname}}</td>
                <td>{{products.category}}</td>
                <td>{{products.price}}</td>
                <td>{{products.description}}</td>
                <td>{{products.offer}}</td>
                <td>{{products.active}}</td>
                <form action="dltPdt" method="post">
                    {% csrf_token %}
                    <input type="hidden" value="{{products.id}}" name="pdtId">
                    <td><input type="submit" class="btn btn-success" value="Delete"></td>
                </form>
            </tr>
            {% endfor %}
        </tbody>
      </table>
</div>

<span id="users"></span>
<div class="container mt-5">
    <h3>Users</h3>
    <table id="table_id" class="display table">
        <thead class="table-success">
            <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Delete</th>
            </tr>
        </thead>
        <tbody>
            {% for users in allUsers %}
            {% if users.is_superuser %}
            {% else %}
            <tr>
                <td>{{users.username}}</td>
                <td>{{users.email}}</td>
                <form action="dlteUser" method="post">
                    {% csrf_token %}
                    <input type="hidden" value="{{users.id}}" name="userId">
                    <td><input type="submit" class="btn btn-success" value="Delete"></td>
                </form>
            </tr>
            {% endif %}
            {% endfor %}
        </tbody>
      </table>
</div>

<span id="comments"></span>
<div class="container mt-5 mb-5">
    <h3>Comments</h3>
    <table id="table_comments" class="display table">
        <thead class="table-success">
            <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Comments</th>
                <th>User</th>
                <th>UserId</th>
                <th>Delete</th>
            </tr>
        </thead>
        <tbody>
            {% for comments in allComments %}
            <tr>
                <td>{{comments.name}}</td>
                <td>{{comments.email}}</td>
                <td>{{comments.phone}}</td>
                <td>{{comments.comment}}</td>
                <td>{{comments.user}}</td>
                <td>{{comments.userId_id}}</td>
                <form action="dlteComment" method="post">
                    {% csrf_token %}
                    <input type="hidden" value="{{comments.id}}" name="commentId">
                    <td><input type="submit" class="btn btn-success" value="Delete"></td>
                </form>
            </tr>
            {% endfor %}
        </tbody>
      </table>
</div>

<span id="orders"></span>
<div class="container mt-5">
    <h2>Orders</h2>
    <div class="row">
        <div class="height-100 mt-5" style="overflow: auto;">
        <!-- change height to increase the number of visible row  -->
            <table id="table_orders" class="table table-hover">
                <thead class="table-success">
                    <tr>
                        <th>Name</th>
                        <th>Phone Number</th>
                        <th>Address</th>
                        <th>Address 2</th>
                        <th>District</th>
                        <th>Zip</th>
                        <th>Payment Method</th>
                        <th>ProductName</th>
                        <th>Quantity</th>
                        <th>Price</th>
                        <th>Category</th>
                        <th>User</th>
                        <th>Delivery</th>
                        <th>Date</th>
                        <th>Delivery Updation</th>
                        <th>Delete</th>
                    </tr>
                </thead>
                {% for orders in allOrders %}
                <tr>
                    <td>{{orders.name}}</td>
                    <td>{{orders.phone}}</td>
                    <td>{{orders.address}}</td>
                    <td>{{orders.address2}}</td>
                    <td>{{orders.district}}</td>
                    <td>{{orders.zip}}</td>
                    <td>{{orders.paymentMethod}}</td>
                    <td><button class="card-text btn btn-light"><strong>{{orders.products}}</strong></button></td>
                    <td><button class="card-text btn btn-light"><strong>{{orders.quantity}}</strong></button></td>
                    <td><button class="card-text btn btn-light"><strong>{{orders.price}}</strong></button></td>
                    <td>{{orders.category}}</td>
                    <td>{{orders.userId_id}}</td>
                    <td><button class="card-text btn btn-success"><strong>{{orders.delivery}}</strong></button></td>
                    <td>{{orders.date}}</td>
                    <td>
                                <form action='' method="POST">
                                    <input type="hidden" name="SI" value="">
                                    <input class="btn btn-primary mt-4" type="button" onclick="delivery('Packed','{{orders.id}}')" id="myOrderOnTheWay" value="Packed" style="border-radius: 10px; color:white">
                                </form>
                                    <form action='' method="POST">
                                        <input type="hidden" name="SI" value="">
                                        <input class="btn btn-success mt-4" type="button" onclick="delivery('Delivered','{{orders.id}}')" id="myOrderDelivered" value="Delivered" style="border-radius: 10px; color:white">
                                    </form>
                    </td>
                    <td>
                        <form action='dlteOrder' method="POST">
                          {% csrf_token %}
                            <input type="hidden" name="orderId" value="{{orders.id}}">
                            <input class="btn btn-warning mt-4" type="submit" name="myOrderDlte" value="Delete" style="border-radius: 10px; color:white">
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </table>
        </div>  
    </div>
</div>

<!-- ERP Total Sales -->

<span id="stats"></span>
<div class="container mt-5">
    <h1>Stats</h1>
    <h1>Todays Sale</h1>
      <div class="row">
          <div class="col-md-6 col-12 col-sm-12">
              <div id="piechart"></div>
          </div>
          <div class="col-md-6 col-12 col-sm-12">
              <div id="piechartexpense"></div>
          </div>
      </div>


      <div class="row">
        <div class="mt-5" style="overflow: hidden;">
      <!-- change height to increase the number of visible row  -->
          <h3>Expenses</h3>
          <table class="table table-hover" id="expense">
              <thead class="table-success">
                  <tr>
                      <th>Date</th>
                      <th>FoodItems</th>
                      <th>Rent</th>
                      <th>Electricity</th>
                      <th>Total Salary</th>
                      <th>Other Expenses</th>
                      <th>Total Expenses</th>
                      <th>Delete</th>
                  </tr>
              </thead>
              <tbody>
                  {% for expenses in allExpenses %}
                    <tr>
                        <td>{{expenses.CurrentDate}}</td>
                        <td>{{expenses.FoodItems}}</td>
                        <td>{{expenses.Rent}}</td>
                        <td>{{expenses.Electricity}}</td>
                        <td>{{expenses.TotalSalary}}</td>
                        <td>{{expenses.OtherExpense}}</td>
                        <td><strong>{{expenses.TotalExpense}}</strong></td>
                        <td>
                            <form action='dlteExpense' method="POST">
                              {% csrf_token %}
                                <input type="hidden" name="expenseId" value="{{expenses.id}}">
                                <input class="btn btn-success" type="submit" name="expenseDlte" value="Delete" style="border-radius: 10px">
                            </form>
                        </td>
                    </tr>
                  {% endfor %}
            </tbody>
            <tfoot>
              <tr>
                <td></td>
                <td><strong>{{TotalGross}}</strong></td>
                <td><strong>{{Rent}}</strong></td>
                <td><strong>{{Electricity}}</strong></td>
                <td><strong>{{TotalSalary}}</strong></td>
                <td><strong>{{OtherExpense}}</strong></td>
                <td><strong>{{TotalExpense}}</strong></td>
                <td></td>
              </tr>
            </tfoot>
          </table>
        </div>  
      </div>
      <div class="row">
        <div class="mt-5" style="overflow: hidden;">
        <h3>Total Income</h3>
        <!-- change height to increase the number of visible row  -->
            <table class="table table-hover">
                <thead class="table-success">
                    <tr>
                        <th>Date</th>
                        <th>ProductName</th>
                        <th>Quantity</th>
                        <th>Price</th>
                        <th>Delete</th>
                    </tr>
                </thead>
                <tbody>
                {% for allOrders in TodayTotalIncome %}
                        <tr>
                            <td>{{allOrders.date}}</td>
                            <td>{{allOrders.products}}</td>
                            <td>{{allOrders.quantity}}</td>
                            <td>{{allOrders.price}}</td>
                            <td>
                              <form action='dlteOrder' method="POST">
                                {% csrf_token %}
                                  <input type="hidden" name="orderId" value="{{allOrders.id}}">
                                  <input class="btn btn-warning mt-4" type="submit" name="myOrderDlte" value="Delete" style="border-radius: 10px; color:white">
                              </form>
                            </td>
                        </tr>
                {% endfor %}
                </tbody>
                <tfoot>
                  <tr>
                    <td></td>
                    <td></td>
                    <td><strong>{{totalIncomeQuantity}}</strong></td>
                    <td><strong>{{totalIncomeToday}}</strong></td>
                    <td></td>
                  </tr>
                </tfoot>
            </table>
        </div>  
        <div class="row">
          <div class="col-md-6">
            <div class="mt-5" style="overflow: hidden;">
              <h3>Total Gross Profit</h3>
              <!-- change height to increase the number of visible row  -->
                  <table class="table table-hover">
                      <thead class="table-success">
                          <tr>
                              <th>Cost for Food Items</th>
                              <th>Total Income</th>
                          </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td>{{TotalGross}}</td>
                          <td>{{totalIncomeToday}}</td>
                        </tr>
                      </tbody>
                      <tfoot>
                        <tr>
                          <td><strong>Total Gross Profit</strong></td>
                          <td><strong>{{TotalGrossProfit}}</strong></td>
                        </tr>
                      </tfoot>
                  </table>
            </div>
          </div>
          <div class="col-md-6">
            <div class="mt-5" style="overflow: hidden;">
              <h3>Total Net Profit</h3>
              <!-- change height to increase the number of visible row  -->
                  <table class="table table-hover">
                      <thead class="table-success">
                          <tr>
                              <th>Cost for Food Items</th>
                              <th>Total Rent</th>
                              <th>Electricity</th>
                              <th>Total Salary</th>
                              <th>Other Expenses</th>
                              <th>Total Income</th>
                          </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td>{{TotalGross}}</td>
                          <td>{{Rent}}</td>
                          <td>{{Electricity}}</td>
                          <td>{{TotalSalary}}</td>
                          <td>{{OtherExpense}}</td>
                          <td>{{totalIncomeToday}}</td>
                        </tr>
                      </tbody>
                      <tfoot>
                        <tr>
                          <td></td>
                          <td></td>
                          <td></td>
                          <td></td>
                          <td><strong>Total Net Profit</strong></td>
                          <td><strong>{{TotalNetProfit}}</strong></td>
                        </tr>
                      </tfoot>
                  </table>
            </div>
          </div>
        </div>
        <div class="row mt-5 mb-5">
          <h3 class="mb-3">Income by Categories</h3>
          <div class="col-md-3">
            <a href="yesterdayIncome" class="btn btn-success">Yesterdays Income</a>
          </div>
          <div class="col-md-3">
            <a href="totalIncome" class="btn btn-success">Total Income Till Now</a>
          </div>
          <div class="col-md-3">
            <form class="form-group" method="post" action="specificDayIncome">
            {% csrf_token %}
              <div class="row">
                <div class="col-md-8">
                  <input class="form-control" type="date" id="day" name="day">
                </div>
                <div class="col-md-4">
                  <input class="btn btn-success" type="submit">
                </div>
              </div>
            </form>
          </div>
          <div class="col-md-3">
            <form class="form-group" method="post" action="dayToDayIncome">
            {% csrf_token %}
              <div class="row">
                <div class="col-md-8">
                  <span>
                  <label for="staticEmail2" class="sr-only">from</label>
                    <input class="form-control" type="date" id="dayFrom" name="dayFrom" required>
                  </span>
                  <span>
                  <label for="staticEmail2" class="sr-only">to</label>
                    <input class="form-control" type="date" id="dayTo" name="dayTo" required>
                  </span>
                </div>
                <div class="col-md-8">
                  <input class="btn btn-success mt-4" name="dayToDay" type="submit">
                </div>
              </div>
            </form>
          </div>
        </div>            
      </div>
  </div>

  <!-- ERP Total Sales -->
  
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  
  <script type="text/javascript">
  // Load google charts
  google.charts.load('current', {'packages':['corechart']});
  google.charts.setOnLoadCallback(drawChart);
  google.charts.setOnLoadCallback(drawChartExpense);
  
  // Draw the chart and set the chart values
  function drawChart() {
    var data = google.visualization.arrayToDataTable([
    ['Food', 'Total Sale per food'],
          
          ['Burger', {{Burger}}],
          ['Pizza', {{Pizza}}],
          ['Shawarma', {{Shawarma}}],
          ['FriedChicken', {{FriedChicken}}],
          ['Juices', {{Juice}}],
  //   ['Eat', 2],
  //   ['TV', 4],
  //   ['Gym', 2],
  //   ['Sleep', 8]
  ]);
  
    // Optional; add a title and set the width and height of the chart
    var options = {'title':'Sale', 'width':550, 'height':400};
  
    // Display the chart inside the <div> element with id="piechart"
    var chart = new google.visualization.PieChart(document.getElementById('piechart'));
    chart.draw(data, options);
  }





  function drawChartExpense() {
    var data = google.visualization.arrayToDataTable([
    ['Expense', 'Expense per Day'],
          
          ['Cost of Food Items', {{TotalGross}}],
          ['Rent', {{Rent}}],
          ['Electricity Bill', {{Electricity}}],
          ['Total Salary Paid', {{TotalSalary}}],
          ['Other Expenses', {{OtherExpense}}],
  ]);
  
    // Optional; add a title and set the width and height of the chart
    var options = {'title':'Expenses', 'width':550, 'height':400};
  
    // Display the chart inside the <div> element with id="piechart"
    var chart = new google.visualization.PieChart(document.getElementById('piechartexpense'));
    chart.draw(data, options);
  }
  </script>




<script>
    function delivery(deliver,orderId){
        var deliveryStatus = deliver
        var orderId = orderId
        var data = {
          'csrfmiddlewaretoken' : '{{csrf_token}}',
          'deliveryStatus' : deliveryStatus,
          'orderId' : orderId,
        }
        $.ajax({
            url:'/delivery',
            method:'POST',
            data: data,
            dataType: 'json',
            success:function(data){
              if(data.success){
                alert("Item " + deliveryStatus)
                window.location.replace('adminHome#orders')
              }else{
                alert("Item is not Recognised")
              }
            }
          })
  }
    $(document).ready(function() {
        $('input[type="file"]').change(function(e) {
            var geekss = e.target.files[0].name;
            $("h4").text(geekss + ' is the selected file.');

        });
    });
</script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.js"></script>
<script>
  $(document).ready( function () {
    $('#table_id').DataTable();
    $('#table_products').DataTable();
    $('#table_orders').DataTable();
    $('#table_comments').DataTable();
} );
</script>
{% endblock %}